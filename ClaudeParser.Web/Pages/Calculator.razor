@page "/calculator"
@using ClaudeParser.Examples
@using ClaudeParser.Core

<PageTitle>Calculator - ClaudeParser</PageTitle>

<h1>ğŸ§® Calculator Parser</h1>

<p>å››å‰‡æ¼”ç®—å¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚æ¼”ç®—å­ã®å„ªå…ˆé †ä½ã¨çµåˆè¦å‰‡ã‚’æ­£ã—ãå‡¦ç†ã—ã¾ã™ã€‚</p>

<div class="row">
    <div class="col-md-8">
        <div class="mb-3">
            <label for="expression" class="form-label">å¼</label>
            <input type="text" class="form-control form-control-lg" id="expression" 
                   @bind="expression" @bind:event="oninput" @bind:after="Calculate"
                   placeholder="ä¾‹: (1 + 2) * 3 - 4 / 2" />
        </div>
        <button class="btn btn-secondary" @onclick="Clear">ã‚¯ãƒªã‚¢</button>
    </div>
</div>

@if (!string.IsNullOrEmpty(result))
{
    <div class="mt-4">
        <div class="alert @(hasError ? "alert-danger" : "alert-success")" role="alert">
            @if (hasError)
            {
                <h5>ã‚¨ãƒ©ãƒ¼</h5>
                <pre style="white-space: pre-wrap; margin: 0;">@result</pre>
            }
            else
            {
                <h5>çµæœ</h5>
                <span class="fs-3">@result</span>
            }
        </div>
    </div>
}

<div class="mt-4">
    <h3>ã‚µãƒãƒ¼ãƒˆã™ã‚‹æ¼”ç®—å­</h3>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>æ¼”ç®—å­</th>
                <th>èª¬æ˜</th>
                <th>å„ªå…ˆåº¦</th>
                <th>çµåˆè¦å‰‡</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><code>+</code></td><td>åŠ ç®—</td><td>ä½</td><td>å·¦çµåˆ</td></tr>
            <tr><td><code>-</code></td><td>æ¸›ç®—</td><td>ä½</td><td>å·¦çµåˆ</td></tr>
            <tr><td><code>*</code></td><td>ä¹—ç®—</td><td>ä¸­</td><td>å·¦çµåˆ</td></tr>
            <tr><td><code>/</code></td><td>é™¤ç®—</td><td>ä¸­</td><td>å·¦çµåˆ</td></tr>
            <tr><td><code>%</code></td><td>å‰°ä½™</td><td>ä¸­</td><td>å·¦çµåˆ</td></tr>
            <tr><td><code>^</code></td><td>ç´¯ä¹—</td><td>é«˜</td><td>å³çµåˆ</td></tr>
            <tr><td><code>-x</code></td><td>å˜é …ãƒã‚¤ãƒŠã‚¹</td><td>æœ€é«˜</td><td>å‰ç½®</td></tr>
            <tr><td><code>+x</code></td><td>å˜é …ãƒ—ãƒ©ã‚¹</td><td>æœ€é«˜</td><td>å‰ç½®</td></tr>
            <tr><td><code>( )</code></td><td>æ‹¬å¼§</td><td>-</td><td>-</td></tr>
        </tbody>
    </table>
</div>

<div class="mt-4">
    <h3>ã‚µãƒ³ãƒ—ãƒ«å¼</h3>
    <div class="d-flex flex-wrap gap-2">
        @foreach (var sample in samples)
        {
            <button class="btn btn-outline-primary btn-sm" @onclick="() => SetSample(sample)">@sample</button>
        }
    </div>
</div>

@code {
    private string expression = "";
    private string result = "";
    private bool hasError = false;

    private readonly string[] samples = new[]
    {
        "1 + 2 * 3",
        "(1 + 2) * 3",
        "2 ^ 3 ^ 2",
        "10 - 5 - 2",
        "-5 * 3",
        "3.14 * 2",
        "10 % 3",
        "2 ^ 10",
        "(1 + 2) * (3 + 4)"
    };

    private void Calculate()
    {
        if (string.IsNullOrWhiteSpace(expression))
        {
            hasError = false;
            result = "";  // ç©ºã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã—ãªã„
            return;
        }

        try
        {
            var value = CalculatorParser.Evaluate(expression);
            hasError = false;
            result = value.ToString("G");
        }
        catch (ParseException ex)
        {
            hasError = true;
            result = ex.Error.ToDetailedString(expression);
        }
        catch (Exception ex)
        {
            hasError = true;
            result = ex.Message;
        }
    }

    private void Clear()
    {
        expression = "";
        result = "";
        hasError = false;
    }

    private void SetSample(string sample)
    {
        expression = sample;
        Calculate();
    }
}
